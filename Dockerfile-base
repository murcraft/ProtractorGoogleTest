FROM node:11.4.0-slim

ENV CHROME_PACKAGE="google-chrome-stable_67.0.3396.99-1_amd64.deb"
ENV CHROME_DRIVER=2.40
ENV DBUS_SESSION_BUS_ADDRESS=/dev/null

RUN echo "deb http://http.debian.net/debian stretch-backports main" > /etc/apt/sources.list.d/stretch-backports.list && \
    apt-get update && \
    mkdir -p /usr/share/man/man1 && \
    apt-get install -y -t stretch-backports \
    openssl ca-certificates openjdk-8-jre-headless\
    xvfb bzip2 vim git wget libdbus-glib-1-2 \
    gconf2-common gconf-service libappindicator1 libdbusmenu-gtk4 libgconf-2-4 libgtk2.0-0 libgtk2.0-bin libgtk2.0-common libindicator7 \
    graphicsmagick ghostscript&& \
    wget -q http://mirror.vitalinux.educa.aragon.es/google/pool/main/g/google-chrome-stable/${CHROME_PACKAGE} && \
    dpkg --unpack ${CHROME_PACKAGE} && \
    apt-get install -f -y && \
    apt-get clean && \
    rm ${CHROME_PACKAGE} && \
    rm -rf /tmp/*